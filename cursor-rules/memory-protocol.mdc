---
description: Persistent memory protocol — automatically read and write project memory across sessions
globs: *
---

# Persistent Memory Protocol

## Session Start — ALWAYS DO THIS

At the start of EVERY conversation involving project work:

1. **Check** if `.planning/MEMORY.md` exists in the project root
2. If it exists, **read it silently** before doing anything else
3. Also **read** `.planning/handoffs/LATEST.md` if it exists
4. **Acknowledge** context briefly: "From memory: we're working on [X], last session we [Y]"
5. Use this context to inform ALL your work in this session

## During Session — CAPTURE AS YOU GO

### On Significant Decisions
Append to `.planning/decisions/DECISIONS.md`:
```
## [DATE] — [Topic]
**Decision:** [What was decided]
**Rationale:** [Why]
```

### On Discovering Bugs/Gotchas
Append to `.planning/context/gotchas.md`:
```
## [Component]
**Issue:** [Description]
**Workaround:** [How to handle]
```

### On Architecture Changes
Update `.planning/context/architecture.md` with the change.

## Session End — ALWAYS DO THIS

When significant work is complete or the user indicates session end:

1. **Create** session log: `.planning/sessions/YYYY-MM-DD-session-N.md`
   - What was done, decisions made, files changed, next steps
2. **Write** handoff: `.planning/handoffs/LATEST.md`
   - Summary, current state, next steps, blockers, gotchas
3. **Update** `.planning/MEMORY.md` with new information
4. **Compress** if MEMORY.md exceeds 300 lines

## Memory Structure

```
.planning/
├── MEMORY.md              # Project brain (~300 lines max)
├── sessions/              # Session logs
├── decisions/DECISIONS.md # Decision log
├── context/
│   ├── architecture.md    # Architecture decisions
│   ├── patterns.md        # Code patterns
│   ├── gotchas.md         # Known issues
│   └── tech-debt.md       # Technical debt
└── handoffs/LATEST.md     # Last session handoff
```

## Rules

- NEVER skip reading MEMORY.md at session start
- NEVER skip writing the handoff at session end
- ALWAYS keep MEMORY.md under 300 lines
- NEVER store sensitive data (API keys, passwords) in memory files
- ALWAYS compress older entries when memory grows
- Commit `.planning/` to version control (secrets in .gitignore)
